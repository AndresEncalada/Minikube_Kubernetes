# Abir docker
# Ejecutar minikube
minikube start
minikube start --driver=docker

# Borrar clusters viejos
minikube delete

# powershell
minikube -p minikube docker-env --shell powershell | Invoke-Expression

#CMD
@FOR /f "tokens=*" %i IN ('minikube -p minikube docker-env --shell cmd') DO @%i

# 1. Backend
cd restaurante-app/backend
docker build -t tu-usuario/restaurante-backend:v1 .

# 2. Worker
cd ../worker
docker build -t tu-usuario/restaurante-worker:v1 .

# 3. Frontend
cd ../frontend
docker build -t tu-usuario/restaurante-frontend:v1 .

cd ../..


# Desplegar
kubectl apply -f restaurante-app/k8s-completo.yaml

# Verifica que los 5 pods estén corriendo (Mongo, Redis, Back, Front, Worker)
kubectl get pods

# Abre la aplicación
minikube service frontend-service

#Borrar todos
kubectl delete all --all
#Borrar uno
kubectl delete pod nombrePod

#Escalar
kubectl scale deployment worker --replicas=3

#Ver logs
# Sigue los logs
kubectl logs -f nombrePod






:: Crear el deployment con la imagen nginxdemos/hello
kubectl create deployment web-server --image=nginxdemos/hello:latest --replicas=1

:: EVIDENCIA 1
kubectl get deployments
kubectl get pods

:: A. Crear servicio tipo ClusterIP (Interno)
kubectl expose deployment web-server --port=80 --target-port=80 --type=ClusterIP --name=web-service

:: B. Confirmar que responde dentro del clúster
:: Primero obtén la IP (anótala)
kubectl get svc web-service

:: Entra a minikube (Linux)
minikube ssh

:: --- DENTRO DE MINIKUBE (Esto es Linux) ---
:: Escribe: curl <LA-IP-QUE-ANOTASTE>
:: Luego escribe: exit
:: --- FIN MINIKUBE ---

:: C. Modificar a NodePort (Hacerlo público)
:: ¡OJO! En CMD las comillas del JSON deben escaparse con backslash \
kubectl patch service web-service -p "{\"spec\": {\"type\": \"NodePort\"}}"

:: D. Validar acceso externo (EVIDENCIA 3)
minikube service web-service

Scaling 
:: Subir a 4 réplicas
kubectl scale deployment web-server --replicas=4

:: EVIDENCIA 4
kubectl get pods


Actualización 

:: Cambiar la imagen a nginx:alpine
:: El * indica "todos los contenedores del deployment"
kubectl set image deployment/web-server *=nginx:alpine

:: Ver cómo se actualizan (Presiona Ctrl+C para salir cuando terminen)
kubectl get pods -w

:: Verificar el cambio visualmente (EVIDENCIA 5)
minikube service web-service


